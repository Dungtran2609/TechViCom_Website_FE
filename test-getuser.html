<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Get User API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Get User API</h1>
        
        <div class="form-group">
            <label for="userId">User ID:</label>
            <input type="number" id="userId" value="13">
        </div>
        
        <div class="form-group">
            <label for="accessToken">Access Token (optional):</label>
            <input type="text" id="accessToken" placeholder="Paste your access token here">
        </div>
        
        <button onclick="testGetUser()">Test Get User</button>
        <button onclick="getTokenFromStorage()">Get Token from localStorage</button>
        <button onclick="clearResult()">Clear Result</button>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function getTokenFromStorage() {
            const token = localStorage.getItem('access_token');
            if (token) {
                document.getElementById('accessToken').value = token;
                showResult('info', 'Token loaded from localStorage', `Token: ${token.substring(0, 50)}...`);
            } else {
                showResult('error', 'No token found', 'No access token found in localStorage');
            }
        }
        
        async function testGetUser() {
            const userId = document.getElementById('userId').value;
            const accessToken = document.getElementById('accessToken').value;
            const resultDiv = document.getElementById('result');
            
            if (!userId) {
                showResult('error', 'Missing User ID', 'Please enter a User ID');
                return;
            }
            
            if (!accessToken) {
                showResult('error', 'Missing Access Token', 'Please enter an access token');
                return;
            }
            
            try {
                console.log('Testing get user with ID:', userId);
                console.log('Using token:', accessToken.substring(0, 20) + '...');
                
                const response = await fetch(`http://localhost:8000/api/v1/users/${userId}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${accessToken}`
                    },
                    mode: 'cors',
                    credentials: 'include'
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok) {
                    showResult('success', 'Get User Successful!', `
                        <p><strong>User ID:</strong> ${data.id}</p>
                        <p><strong>User Name:</strong> ${data.name}</p>
                        <p><strong>User Email:</strong> ${data.email}</p>
                        <p><strong>Phone:</strong> ${data.phone_number}</p>
                        <p><strong>Gender:</strong> ${data.gender}</p>
                        <p><strong>Birthday:</strong> ${data.birthday}</p>
                        <p><strong>Image Profile:</strong> ${data.image_profile}</p>
                        <p><strong>Is Active:</strong> ${data.is_active}</p>
                    `);
                } else {
                    showResult('error', 'Get User Failed!', `
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Error:</strong> ${data.message || 'Unknown error'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `);
                }
            } catch (error) {
                console.error('Get user error:', error);
                showResult('error', 'Network Error!', `
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>This might be a CORS issue or the backend server is not running.</p>
                `);
            }
        }
        
        function showResult(type, title, content) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<h3>${title}</h3>${content}`;
            resultDiv.style.display = 'block';
        }
        
        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
        }
        
        // Auto-load token from localStorage on page load
        window.onload = function() {
            getTokenFromStorage();
        };
    </script>
</body>
</html> 